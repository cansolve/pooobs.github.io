<!-- build time:Fri Jun 14 2019 09:44:43 GMT+0800 (CST) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>滑向未来（现代 JS 与 CSS 滚动实现指南) | cansolve</title><meta name="description" content="英文： Evil Martians 译文：众成翻译/sea_ljfwww.zcfy.cc/article/scroll-to-the-future一些（网站）滚动的效果是如此令人着迷但你却不知该如何实现，本文将为你揭开它们的神秘面纱。我们将基于最新的技术与规范为你介绍最新的 JavaScript 与 CSS 特性，（当你付诸实践时，）将使你的页面滚动更平滑、美观且性能更好。大多数的网页的内容都无法"><meta name="keywords" content="css"><meta property="og:type" content="article"><meta property="og:title" content="滑向未来（现代 JS 与 CSS 滚动实现指南)"><meta property="og:url" content="http://cansolve.cn/2018/06/03/daily6/index.html"><meta property="og:site_name" content="blog"><meta property="og:description" content="英文： Evil Martians 译文：众成翻译/sea_ljfwww.zcfy.cc/article/scroll-to-the-future一些（网站）滚动的效果是如此令人着迷但你却不知该如何实现，本文将为你揭开它们的神秘面纱。我们将基于最新的技术与规范为你介绍最新的 JavaScript 与 CSS 特性，（当你付诸实践时，）将使你的页面滚动更平滑、美观且性能更好。大多数的网页的内容都无法"><meta property="og:locale" content="default"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfzgsOgAT11uFEPedxAicRlYjePnTImjsvTpKpRnh9MwyTOaCoAU3yq7Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfFRq6PHibZL73jSVzmIrG2gzZ9xW8liaEqR9sYyd5icjOvIz0ianGCFq3JA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfVFryicxsTYj8JicKyfbYcOc3ibicGdGqqzZQysibsUmmFUlyKwz4S7mibiaXQ/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfELwBFv2dOYiciaiaDrbUcw1ia3CVGlTYexd6gH99OakkM9o56AF6Vnxmmw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfWOx5gubdeib6FTmh08zjnkyInQDMaOMiaaicFFhyPbYpNhVK6dOjbmQGw/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfEozAicEbhcECu4T64I55snoEkt52a94fWs2aSiaG7ZlibiaRAbIYnpwxew/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagf5LPnKbh9PNT5nlRtCWMeUsjQ1OoUtbOfSMDVXpgVjFlx7NRFV3XTtA/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"><meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagffibNW1A69DE9caPYibwW3UcjXNLz1KWPMNBxRvgiakklYsRfmKwicN0lXw/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"><meta property="og:updated_time" content="2018-12-18T11:13:26.305Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="滑向未来（现代 JS 与 CSS 滚动实现指南)"><meta name="twitter:description" content="英文： Evil Martians 译文：众成翻译/sea_ljfwww.zcfy.cc/article/scroll-to-the-future一些（网站）滚动的效果是如此令人着迷但你却不知该如何实现，本文将为你揭开它们的神秘面纱。我们将基于最新的技术与规范为你介绍最新的 JavaScript 与 CSS 特性，（当你付诸实践时，）将使你的页面滚动更平滑、美观且性能更好。大多数的网页的内容都无法"><meta name="twitter:image" content="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfzgsOgAT11uFEPedxAicRlYjePnTImjsvTpKpRnh9MwyTOaCoAU3yq7Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"><link rel="canonical" href="http://cansolve.cn/2018/06/03/daily6/index.html"><link rel="alternate" href="/atom.xml" title="blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/cansolve" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">cansolve</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Developer &amp; Designer</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> FuZhou, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/"><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">链接</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/cansolve" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/2823970812/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>小生不才，请多多指教!</p><p>个人公众号，有兴趣扫码关注一下吧</p><p style="width:150px"><img src="http://img.cansolve.cn/qrcode.jpg"></p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/个人/">个人</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分享/">分享</a><span class="category-list-count">6</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/建站/">建站</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务器/">服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动端/">移动端</a><span class="tag-list-count">3</span></li></ul></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最近更新</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/个人/">个人</a></p><p class="item-title"><a href="/2019/05/12/daily20/" class="title">聊一下this的指向问题</a></p><p class="item-date"><time datetime="2019-05-12T02:36:19.000Z" itemprop="datePublished">2019-05-12</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/个人/">个人</a></p><p class="item-title"><a href="/2019/03/22/daily19/" class="title">常见jquery方法汇总</a></p><p class="item-date"><time datetime="2019-03-22T02:36:19.000Z" itemprop="datePublished">2019-03-22</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/个人/">个人</a></p><p class="item-title"><a href="/2019/03/15/daily18/" class="title">移动端常见问题集锦</a></p><p class="item-date"><time datetime="2019-03-15T05:36:19.000Z" itemprop="datePublished">2019-03-15</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/个人/">个人</a></p><p class="item-title"><a href="/2019/01/25/daily17/" class="title">聊聊你可能并没有完全掌握的 (font-family)和粗细(font-weight)问题</a></p><p class="item-date"><time datetime="2019-01-25T08:31:31.000Z" itemprop="datePublished">2019-01-25</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/个人/">个人</a></p><p class="item-title"><a href="/2019/01/02/daily16/" class="title">日常问题解决（持续更新中）</a></p><p class="item-date"><time datetime="2019-01-02T13:06:28.000Z" itemprop="datePublished">2019-01-02</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-daily6" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">滑向未来（现代 JS 与 CSS 滚动实现指南)</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2018/06/03/daily6/" class="article-date"><time datetime="2018-06-03T04:11:23.000Z" itemprop="datePublished">2018-06-03</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/分享/">分享</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/css/">css</a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2018/06/03/daily6/#comments" class="article-comment-link">评论</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><blockquote><p>英文： Evil Martians 译文：众成翻译/sea_ljf<br><a href="http://www.zcfy.cc/article/scroll-to-the-future" target="_blank" rel="noopener">www.zcfy.cc/article/scroll-to-the-future</a></p></blockquote><p>一些（网站）滚动的效果是如此令人着迷但你却不知该如何实现，本文将为你揭开它们的神秘面纱。我们将基于最新的技术与规范为你介绍最新的 JavaScript 与 CSS 特性，（当你付诸实践时，）将使你的页面滚动更平滑、美观且性能更好。</p><p>大多数的网页的内容都无法在一屏内全部展现，因而（页面）滚动对于用户而言是必不可少的。对于前端工程师与 UX 设计师而言，跨浏览器提供良好的滚动体验，同时符合设计（要求），无疑是一个挑战。尽管 web 标准的发展速度远超从前，但代码的实现往往是落后的。下文将为你介绍一些常见的关于滚动的案例，检查一下你所用的解决方案是否被更优雅的方案所代替。</p><p><strong>消逝的滚动条</strong></p><p>在过去的三十年里，滚动条的外观不断改变以符合设计的趋势，设计师们为（滚动条的）颜色、阴影、上下箭头的形状与边框的圆角实验了多种风格。以下是 Windows 上的变化历程：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfzgsOgAT11uFEPedxAicRlYjePnTImjsvTpKpRnh9MwyTOaCoAU3yq7Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="">（Windows 上的滚动条）</p><p>在2011年，苹果设计师从 ios 上获得灵感，为如何定义“美观的”滚动条确定了方向。所有滚动条均从 Mac 电脑中消失，不再占据任何页面空间，只有在用户触发滚动时（滚动条）才会重新出现（有些用户会设置不隐藏滚动条）。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfFRq6PHibZL73jSVzmIrG2gzZ9xW8liaEqR9sYyd5icjOvIz0ianGCFq3JA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="">（Mac 上的滚动条）</p><p>滚动条安静地消逝并未引起苹果粉丝的不满，已经习惯了 iPhone 与 iPad 上滚动方式的用户很快地习惯了这一设计。大多数开发人员与设计师都认为这是一个“好消息”，因为计算滚动条的宽度可真是件苦差事。</p><p>然而，我们生活在一个拥有众多操作系统与浏览器的世界中，它们（对于滚动）的实现各不相同。如果你和我们一样是一名 Web 开发者，你可不能把“滚动条问题”置之不理。</p><p>以下将为你介绍一些小技巧，使你的用户在滚动时有更好的体验。</p><p><strong>隐藏但可滚动</strong></p><p>先来看看一个关于模态框的经典例子。当它被打开的时候，主页面应该停止滚动。在 CSS 中有如下的快捷实现方式：</p><blockquote><p>body{</p><p>overflow: hidden;</p><p>}</p></blockquote><p>但上述代码会带来一点不良的副作用：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfVFryicxsTYj8JicKyfbYcOc3ibicGdGqqzZQysibsUmmFUlyKwz4S7mibiaXQ/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p><p>（注意红色剪头）</p><p>在这个示例中，为了演示目的，我们在 Mac 系统中设置了强制显示滚动条，因而用户体验与 Windows 用户相似。</p><p>我们该如何解决这个问题呢？如果我们知道滚动条的宽度，每次当模态框出现时，可在主页面的右边设置一点边距。</p><p>由于不同的操作系统与浏览器对滚动条的宽度不一，因而获取它的宽度并不容易。在Mac 系统中，无论任何浏览器（滚动条）都是统一15px，然而 Windows 系统可会令开发者发狂：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfELwBFv2dOYiciaiaDrbUcw1ia3CVGlTYexd6gH99OakkM9o56AF6Vnxmmw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p><p>（“百花齐放”的宽度）</p><p>注意，以上仅是 Windows 系统下基于当前最新版浏览器（测试所得）的结果。以前的（浏览器）版本（宽度）可能有所不同，也没人知道未来（滚动条的宽度）会如何变化。</p><p>不同于猜测（滚动条的宽度），你可以通过 JavaScript 计算它的宽度（译者注：实测以下代码仅能测出原始的宽度，通过 CSS 改变了滚动条宽度后，以下代码也无法测出实际宽度）：</p><blockquote><p>constouter = document.createElement(‘div’);</p><p>constinner = document.createElement(‘div’);</p><p>outer.style.overflow = ‘scroll’;</p><p>document.body.appendChild(outer);</p><p>outer.appendChild(inner);</p><p>constscrollbarWidth = outer.offsetWidth - inner.offsetWidth;</p><p>document.body.removeChild(outer);</p></blockquote><p>尽管仅仅七行代码（就能测出滚动条的宽度），但有数行代码是操作 DOM 的。（为性能起见，）如非必要，尽量避免进行 DOM 操作。</p><p>解决这个问题的另一个方法是在模态框出现时仍保留滚动条，以下是基于这思路的纯 CSS 实现：</p><blockquote><p>html{</p><p>overflow-y: scroll;</p><p>}</p></blockquote><p>尽管“模态框抖动”问题解决了，但整体的外观却被一个无法使用的滚动条影响了，这无疑是设计中的硬伤。</p><p>在我们看来，更好的解决方案是完全地隐藏滚动条。纯粹用 CSS 也是可以实现的。该方法（达到的效果）和 macOS 的表现并不是完全一致，（当用户）滚动时滚动条仍然是不可见的。滚动条总是处于不可见状态，然而页面是可被滚动的。对于Chrome，Safari 和 Opera 而言，可以使用以下的 CSS：</p><blockquote><p>.container::-webkit-scrollbar{</p><p>display: none;</p><p>}</p></blockquote><p>IE 或 Edge 可用以下代码:</p><blockquote><p>.container{</p><p>-ms-overflow-style: none;</p><p>}</p></blockquote><p>至于 Firefox，很不幸，没有任何办法隐藏滚动条。</p><p>正如你所见，并没有任何银弹。任何解决方案都有它的优点与缺点，应根据你项目的需要选择最合适的。</p><p><strong>外观争议</strong></p><p>需要承认的是，滚动条的样子在部分操作系统上并不好看。一些设计师喜欢完全掌控他们（所设计）应用的样式，任何一丝细节也不放过。在 GitHub 上有上百个库借助 JavaScript 取代系统滚动条的默认实现，以达到自定义的效果。</p><p>但如果你想根据现有的浏览器定制一个滚动条呢？（很遗憾，）并没有通用的 API，每个浏览器都有其独特的代码实现。</p><p>尽管5.5版本以后的 IE 浏览器允许你修改滚动条的样式，但它只允许你修改滚动条的颜色。以下是如何重新绘制（滚动条）拖动部分与箭头的代码：</p><blockquote><p>body{</p><p>scrollbar-face-color: blue;</p><p>}</p></blockquote><p>但只改变颜色对提高用户体验而言帮助不大。据此，WebKit 的开发者在2009年提出了（修改滚动条）样式的方案。以下是使用 -webkit 前缀在支持相关样式的浏览器中模拟 macOS 滚动条样式的代码：</p><blockquote><p>::-webkit-scrollbar{</p><p>width: 8px;</p><p>}</p><p>::-webkit-scrollbar-thumb{</p><p>background-color: #c1c1c1;</p><p>border-radius: 4px;</p><p>}</p></blockquote><p>Chrome、Safari、Opera 甚至于 UC 浏览器或者三星自带的桌面浏览器都支持（上述 CSS）。Edge 也有计划实现它们。但三年过去了，该计划仍在中等优先级中（而尚未被实现）。</p><p>当我们讨论滚动条的定制时，Mozilla 基金会基本上是无视了设计师的需求。（有开发者在）17年前就已经提出了一个希望修改滚动条样式的请求。而就在几个月前，Jeff Griffiths（Firefox 浏览器总监）终于为这个问题作出了回答：</p><p>“除非团队中有人对此有兴趣，否则我对此毫不关心。”</p><p>公平地说，从 W3C 的角度看来，尽管 WebKit 的实现得到广泛的支持，但它仍然不是标准。现有的为滚动条修改样式的草案，是基于 IE 的：仅能修改它的颜色。</p><p>伴随着请求如同 WebKit 一样支持滚动条样式修改 issue 的提交，争议仍在继续。如果你想影响 CSS 工作小组，是时候参与讨论了。也许这不是优先级最高的问题，但（如同 WebKit 一样修改滚动条样式）得到标准化后，能使很多前端工程师与设计师轻松很多。</p><p><strong>流畅的操作体验</strong></p><p>对于滚动而言，最常见的任务是登录页的导航（跳转）。通常，它是通过锚点链接来完成的。只需要知道元素的 id 即可：</p><blockquote><p>&lt;ahref=”#section”&gt;</p></blockquote><p>点击该链接会 跳 到（该锚点对应的）区块上，（然而） UX 设计师一般会坚持认为该过程应是平滑地运动的。GitHub 上有大量造好的轮子（帮你解决这个问题），然而它们或多或少都用到 JavaScript。（其实）只用一行代码也能实现同样的效果，最近DOM API 中的 Element.scrollIntoView() 可以通过传入配置对象来实现平滑滚动：</p><blockquote><p>elem.scrollIntoView({</p><p>behavior: ‘smooth’</p><p>});</p></blockquote><p>然而该属性兼容性较差且仍是通过脚本（来控制样式）。如有可能，应尽量少用额外的脚本。</p><p>幸运的是，有一个全新的 CSS 属性（仍在工作草案中），可以用简单的一行代码改变整个页面滚动的行为。</p><blockquote><p>html{</p><p>scroll-behavior: smooth;</p><p>}</p></blockquote><p>结果如下:</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfWOx5gubdeib6FTmh08zjnkyInQDMaOMiaaicFFhyPbYpNhVK6dOjbmQGw/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p><p>（从一个区块跳到另一个）</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagfEozAicEbhcECu4T64I55snoEkt52a94fWs2aSiaG7ZlibiaRAbIYnpwxew/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p><p>（平滑地滚动）</p><p>你可以在 codepen 上试验这个属性。在撰写本文时，scroll-behavior 仅在 Chrome、 Firefox 与 Opera 上被支持，但我们希望它能被广泛支持，因为使用 CSS （比使用 JavaScript）在解决页面滚动问题时优雅得多，并更符合“渐进增强”的模式。</p><p><strong>粘性 CSS</strong></p><p>另一个常见的需求是根据滚动方向动态地定住元素，即有名的“粘性（即 CSS 中的position: sticky）”效应。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagf5LPnKbh9PNT5nlRtCWMeUsjQ1OoUtbOfSMDVXpgVjFlx7NRFV3XTtA/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""><br>（一个粘性元素）</p><p>在以前的日子里，要实现一个“粘性”元素需要编写复杂的滚动处理函数去计算元素的大小。（然而）该函数较难处理元素在“黏住”与“不黏住”之间微小的延迟，（通常会）导致（元素）抖动的出现。通过 JavaScript 来实行（“粘性”元素）也有性能上的问题，特别是在（需要）调用 [Element.getBoundingClientRect() ]时(<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)。" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)。</a></p><p>不久之前，CSS 实现了 position: sticky 属性。只需通过指定（某方向上的）偏移量即可实现我们想要的效果。</p><blockquote><p>.element{</p><p>position: sticky;</p><p>top: 50px;</p><p>}</p></blockquote><p>（编写上述代码后，）剩下的就交由浏览器实现即可。你可以在 codepen 上试验一下。撰写本文之时，position: sticky 在各式浏览器（包括移动端浏览器）上支持良好，所以如果你还在使用 JavaScript 去解决这个问题的话，是时候换成纯 CSS 的实现了。</p><p><strong>全面使用函数节流</strong></p><p>从浏览器的角度看来，滚动是一个事件，因此在 JavaScript 中是使用一个标准化的事件监听器 addEventListener 去处理它： ，</p><blockquote><p>window.addEventListener(‘scroll’,() =&gt; {</p><p>constscrollTop = window.scrollY;</p><p>/<em> doSomething with scrollTop </em>/</p><p>});</p></blockquote><p>用户往往高频率地滚动（页面），但如果滚动事件触发太频繁的话，会导致性能上的问题，可以通过使用函数节流这一技巧去优化它。</p><blockquote><p>window.addEventListener(‘scroll’,throttle(() =&gt; {</p><p>constscrollTop = window.scrollY;</p><p>/<em> doSomething with scrollTop </em>/</p><p>}));</p></blockquote><p>你需要定义一个节流函数包装原来的事件监听函数，（节流函数是）减少被包装函数的执行次数，只允许它在固定的时间间隔之内执行一次：</p><blockquote><p>functionthrottle(action,wait = 1000){</p><p>let time = Date.now();</p><p>returnfunction(){</p><p>if((time + wait - Date.now()) &lt; 0){</p><p>action();</p><p>time = Date.now();</p><p>}</p><p>}</p><p>}</p></blockquote><p>为了使（节流后的）滚动更平滑，你可以通过使用 window.requestAnimationFrame() 来实现函数节流：</p><blockquote><p>functionthrottle(action){</p><p>let isRunning = false;</p><p>returnfunction(){</p><p>if(isRunning)return;</p><p>isRunning = true;</p><p>window.requestAnimationFrame(() =&gt; {</p><p>action();</p><p>isRunning = false;</p><p>});</p><p>}</p><p>}</p></blockquote><p>当然，你可以通过现有的开源轮子来实现，就像 Lodash 一样。你可以访问 codepen 来看看上述解决方案与 Lodash 中的 _.throttle 之间的区别。</p><p>使用哪个（开源库）并不重要，重要的是在需要的时候，记得优化你（页面中的）滚动处理函数。</p><p><strong>在视窗中显示</strong></p><p>当你需要实现图片懒加载或者无限滚动时，需要确定元素是否出现在视窗中。这可以在事件监听器中处理，最常见的解决方案是使用 lement.getBoundingClientRect() ：</p><blockquote><p>window.addEventListener(‘scroll’,() =&gt; {</p><p>constrect = elem.getBoundingClientRect();</p><p>constinViewport = rect.bottom &gt; 0 &amp;&amp; rect.right &gt; 0 &amp;&amp;</p><p>rect.left &lt; window.innerWidth &amp;&amp;</p><p>rect.top &lt; window.innerHeight;</p><p>});</p></blockquote><p>上述代码的问题在于每次调用 getBoundingClientRect 时都会触发回流，严重地影响了性能。在事件处理函数中调用（ getBoundingClientRect ）尤为糟糕，就算使用了函数节流（的技巧）也可能对性能没多大帮助。 （回流是指浏览器为局部或整体地重绘某个元素，需要重新计算该元素在文档中的位置与形状。）</p><p>在2016年后，可以通过使用 Intersection Observer 这一 API 来解决问题。它允许你追踪目标元素与其祖先元素或视窗的交叉状态。此外，尽管只有一部分元素出现在视窗中，哪怕只有一像素，也可以选择触发回调函数：</p><blockquote><p>constobserver = newIntersectionObserver(callback,options);</p><p>observer.observe(element);</p></blockquote><p>此 API 被广泛地支持，但仍有一些浏览器需要 polyfill。尽管如此，它仍是目前最好的解决方案。</p><p><strong>滚动边界问题</strong></p><p>如果你的弹框或下拉列表是可滚动的，那你务必要了解连锁滚动相关的问题：当用户滚动到（弹框或下拉列表）末尾（后再继续滚动时），整个页面都会开始滚动。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/zPh0erYjkib1S4or5PlS9mBibR4uwkGagffibNW1A69DE9caPYibwW3UcjXNLz1KWPMNBxRvgiakklYsRfmKwicN0lXw/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p><p>（连锁滚动的表现）</p><p>当滚动元素到达底部时，你可以通过（改变）页面的 overflow 属性或在滚动元素的滚动事件处理函数中取消默认行为来解决这问题。</p><p>如果你选择使用 JavaScript （来处理），请记住要处理的不是“scroll（事件）”，而是每当用户使用鼠标滚轮或触摸板时触发的“wheel（事件）”：</p><blockquote><p>functionhandleOverscroll(event){</p><p>constdelta = -event.deltaY;</p><p>if(delta&lt; 0 &amp;&amp; elem.scrollHeight - elem.scrollTop){</p><p>elem.scrollTop = elem.scrollHeight;</p><p>event.preventDefault();</p><p>returnfalse;</p><p>}</p><p>if(delta &gt; elem.scrollTop){</p><p>elem.scrollTop = 0;</p><p>event.preventDefault();</p><p>returnfalse;</p><p>}</p><p>returntrue;</p><p>}</p></blockquote><p>不幸的是，这个解决方案不太可靠。同时可能对（页面）性能产生负面影响。</p><p>过度滚动对移动端的影响尤为严重。Loren Brichter 在 iOS 的 Tweetie 应用上创造了一个“下拉刷新”的新手势，这在 UX 社区中引起了轰动：包括 Twitter 与 Facebook 在内的各大应用纷纷采用了（相同的手势）。</p><p>当这个特性出现在安卓端的 Chrome 浏览器中时，问题出现了：它会刷新整个页面而不是加载更多的内容，成为开发者在他们的应用中实现“下拉刷新”时的麻烦。</p><p>CSS 通过 overscroll-behavior 这个新属性解决问题。它通过控制元素滚动到尽头时的行为来解决下拉刷新与连锁滚动所带来的问题，（它的属性值中）也包含针对不同平台特殊值：安卓的 glow 与 苹果系统中的 rubber band。</p><p>现在，上面 GIF 中的问题，在 Chrome、Opera 或 Firefox 中可以通过以下一行代码来解决：</p><blockquote><p>.element{</p><p>overscroll-behavior: contain;</p><p>}</p></blockquote><p>公平地说，IE 与 Edge 实现了（它独有的） -ms-scroll-chaining 属性来控制连锁滚动，但它并不能处理所有的情况。幸运的是，根据这消息，微软的浏览器已经准备实现 overscroll-behavior 这一属性了。</p><p><strong>触屏之后</strong></p><p>触屏设备上的滚动（体验）是一个很大的话题，深入讨论需要另开一篇文章。然而，由于很多开发者忽略了这方面的内容，这里需要提及一下。</p><p>（滚动手势无处不在，令人沉迷，以至于想出了如此疯狂的主意去解决“滚动上瘾”的问题。）</p><p>周围的人在智能手机屏幕上上下移动他们的手指的频率是多少呢？经常这样对吧，当你阅读本文时，你很可能就在这么做。</p><p>当你的手指在屏幕上移动时，你期待的是：页面内容平滑且流畅地移动。</p><p>苹果公司开创了“惯性”滚动并拥有它的专利 。它讯速地成为了用户交互的标准并且我们对此已习以为常。</p><p>但你也许已经注意到了，尽管移动端系统会为你实现页面上的惯性滚动，但当页面内某个元素发生滚动时，即使用户同样期待惯性滚动，但它并不会出现，这令人沮丧。</p><p>这里有一个 CSS 的解决方案，但看起来更像是个 hack：</p><blockquote><p>.element{</p><p>-webkit-overflow-scrolling: touch;</p><p>}</p></blockquote><p>为什么这是个 hack 呢？首先，它只能在支持（webkit）前缀的浏览器上才能工作。其次，它只适用于触屏设备。最后，如果浏览器不支持的话，你就这样置之不理吗？但无论如何，这总归是一个解决方案，你可以试着使用它。</p><p>在触屏设备上，另一个需要考虑的问题是开发者如何处理 touchstart 与 touchmove 事件触发时可能存在的性能问题，它对用户滚动体验的影响非常大。这里详细描述了整个问题。简单来说，现代的浏览器虽然知道如何使得滚动变得平滑，但为确认（滚动）事件处理函数中是否执行了 Event.preventDefault() 以取消默认行为，有时仍可能需要花费500毫秒来等待事件处理函数执行完毕。</p><p>即使是一个空的事件监听器，从不取消任何行为，鉴于浏览器仍会期待 preventDefault 的调用，也会对性能造成负面影响。</p><p>为了准确地告诉浏览器不必担心（事件处理函数中）取消了默认行为，在 WHATWG 的 DOM 标准中存在着一个不太显眼的特性（能解决这问题）。（它就是）Passive event listeners，浏览器对它的支持还是不错的。事件监听函数新接受一个可选的对象作为参数，告诉浏览器当事件触发时，事件处理函数永远不会取消默认行为。（当然，添加此参数后，）在事件处理函数中调用 preventDefault 将不再产生效果。</p><blockquote><p>element.addEventListener(‘touchstart’,e =&gt; {</p><p>/<em> doSomething </em>/</p><p>},{passive: true});</p></blockquote><p>针对不支持该参数的浏览器，这里也有一个 polyfill 。这视频清晰地展示了此改进带来的影响。</p><p><strong>旧技术运行良好，为何还要改动？</strong></p><p>在现代互联网中，过渡地依赖 JavaScript 在各浏览器上实现相同的交互效果不再是合理的，“跨浏览器兼容性”已经成为过去式，更多的 CSS 属性与 DOM API 方法正逐步被各大浏览器所支持。</p><p>在我们看来，当你的项目中，有特别酷炫的滚动效果时，渐进增强是最好的做法。</p><p>你应该提供（给用户）所有（你能提供的）基础用户体验，并逐步在更先进的浏览器上提供更好的体验。</p><p>必要时使用 polyfill，它们不会产生（不必要的）依赖，一旦（某个 polyfill 所支持的属性）得到广泛地支持，你就可以轻松地将它删掉。</p><p>六个月之前，在本文尚未成文之时，之前我们描述的属性只被少量的浏览器所支持。而到了本文发表之时，这些属性已被广泛地支持。</p><p>也许到了现在，当你上下翻阅本文之时，（之前不支持某些属性的）浏览器已经支持了该属性，这使得你编程更容易，并使你的应用打包出来体积更小。</p><p>感谢阅读至此！查阅浏览器的更新日志，积极参与讨论，有助于 web 标准驶向正确的方向。祝大家一帆风顺，顺利滑（滚）向未来！</p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://cansolve.cn/2018/06/03/daily6/" title="滑向未来（现代 JS 与 CSS 滚动实现指南)" target="_blank" rel="external">http://cansolve.cn/2018/06/03/daily6/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>许可协议。如转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/cansolve" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/cansolve" target="_blank"><span class="text-dark">cansolve</span><small class="ml-1x">Web Developer &amp; Designer</small></a></h3><div>一个前端菜鸟的踩坑之路。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2018/06/17/daily7/" title="常见 React 面试题"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2018/04/02/daily1/" title="用Hexo + github搭建自己的博客"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook" data-mobile-sites="weibo,qq"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="wechatpay"><div class="donate-payimg"><img src="http://img.cansolve.cn/wechat_pay.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/cansolve" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/2823970812/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var N={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=N}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"8tRjexSIVN81Y9bYsLwPiKCM-gzGzoHsz",appKey:"agz4mBB4qFr7EjGdVMu4N0x7",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html><!-- rebuild by neat -->